
\tdplotsetmaincoords{70}{93}

\begin{tikzpicture}[scale=0.9,tdplot_main_coords]
 \tikzset{>=latex} % for LaTeX arrow head

  % VARIABLE
  \def\R{4.0}
  \def\dist{12}
  \def\thetazero{60}
  \def\myphi{45}
    \def\thetazero{60}
  \def\myalpha{63.43495}
  
  \def\plate{3}
  \def\pie{3.1415}
  \def\k{5}
  \def\r{\R}
 
   \def\modulus#1#2{sqrt(\dist*\dist+#1*#1+#2*#2)}
    \def\teeta#1#2{atan(sqrt(#1*#1+#2*#2)/\dist)}
    \def\fee#1#2{acos(#1/sqrt(#1*#1+#2*#2))}
\def\factor{1.4}
 \def\az{74}
    \tdplotsetrotatedcoords{0}{0}{0};
 \tdplotsetcoord{O}{0}{0}{0};
  \tdplotsetrotatedcoords{0}{0}{0};
 \tdplotsetcoord{MM}{\R}{90}{\myphi};
\tdplotsetcoord{MMM}{\R*1.9}{90}{\myphi};
 \tdplotsetrotatedcoords{-45}{39}{ 52.23};
\begin{scope}[tdplot_rotated_coords]
 \draw[tdplot_rotated_coords,ultra thick](\R,0,0) arc [start angle=0,end angle=90,x radius=\R,y radius=\R];
\path[tdplot_rotated_coords,thin,fill=gray!20,opacity=0.2](0,0,0)-- (\R,0*\R,0) arc [start angle=0,end angle=90,x radius=\R,y radius=\R]--(0,0,0)--cycle;
\def\coef{1.8};
\tdplotsetcoord{AZplane1}{sqrt(\coef*\coef*\R*\R+\dist*\dist)}{90}{atan(\dist/\R/\coef)};
\tdplotsetcoord{AZplane2}{sqrt(\coef*\coef*\R*\R+\dist*\dist)}{90}{180-atan(\dist/\R/\coef)};
\tdplotsetcoord{AZplane3}{-sqrt(\coef*\coef*\R*\R+\dist*\dist/8}{90}{180-atan(\dist/\R/2.83/\coef)};
\tdplotsetcoord{AZplane4}{-sqrt(\coef*\coef*\R*\R+\dist*\dist/8)}{90}{atan(\dist/\R/2.83/\coef)};
 \draw[dashdotted,tdplot_main_coords](AZplane1)--(AZplane2)-- (AZplane4)--(AZplane3)--cycle;
\node[right=0.5cm] at (AZplane3){$\text{Photon equatorial plane}$ \tiny$ \text{ (Schwarschild coordinates)}$};
\end{scope}
  %drawing the sector alpha
  % Define rotation angles
 \tdplotsetrotatedcoords{270}{90-\thetazero}{90};%The point X'.
 \begin{scope}[tdplot_rotated_coords] 
 \tdplotsetcoord{Xaccent}{\R}{90-\myalpha+90}{0};
 \tdplotsetcoord{Xaccentk}{\R*1.9}{90-\myalpha+90}{0};
 \draw[ tdplot_main_coords,dashed, black] (O)--(Xaccent);
 \draw[ tdplot_main_coords,dashed, black,thick] (Xaccent)--(Xaccentk);
 \draw[fill = white,tdplot_rotated_coords,] (Xaccent) circle (1.5pt);
 \end{scope}
  
  % Draw sphere
   \draw[tdplot_screen_coords,thin,black!30] (0,0,0) circle (\r);
   \foreach \a in {-60,-40,...,60}
     {\tdplotCsDrawLatCircle[thin,black!30]{\r}{\a}}
    \foreach \a in {0,30,...,150}
      {\tdplotCsDrawLonCircle[thin,black!30]{\r}{\a}}
      \tdplotCsDrawLonCircle[,black]{\R}{90};
       \tdplotCsDrawLonCircle[black]{\R}{180};
    	\tdplotCsDrawLatCircle  []{\r}{0};
  % AXES
  \tdplotsetrotatedcoords{0}{0}{0};
 %\tdplotsetcoord{O}{0}{0}{0};
  \tdplotsetcoord{Y1}{\factor*\R}{90}{90};
   \tdplotsetcoord{Y2}{-\factor*\R}{90}{90};
     \tdplotsetcoord{X1}{1.4*\factor*\R}{90}{0};
   \tdplotsetcoord{X2}{-\factor*\R}{90}{0};
        \tdplotsetcoord{Z1}{\factor*\R}{0}{90};
   \tdplotsetcoord{Z2}{-\factor*\R}{0}{-90};
   \tdplotsetcoord{Z}{\factor*\R}{0}{0};
  \draw[tdplot_rotated_coords,dashed,-{Latex[length=3mm, width=1mm]}] (X2) -- (X1) node[left=2,below]{$x$};;
  \draw[tdplot_rotated_coords,dashed,-{Latex[length=3mm, width=1mm]}] (Y2) -- (Y1) node[left=2,right]{$y$};;
   \draw[tdplot_rotated_coords,dashed,-{Latex[length=3mm, width=1mm]}] (Z2) -- (Z1)node[right]{$z$};;

   
   \tdplotsetrotatedcoords{0}{90}{90} % set the rotated coordinate system
\tdplotdrawarc[tdplot_rotated_coords,very thick,,->]{(O)}{1}{90}{90-\thetazero}{anchor=south}{$\theta_0$} ;
  %OBSERVER
\tdplotsetrotatedcoords{90}{\thetazero}{270} % set the rotated coordinate system
  \begin{scope}[tdplot_rotated_coords] % use the rotated coordinate system
   \tdplotsetcoord{Obs}{\dist}{0}{0)};
   %Let's travel to the observer
  \tdplotsetrotatedcoordsorigin{(Obs)};
  %Photographic Plate
 \draw[tdplot_rotated_coords,decoration={markings, 
mark= at position 0.60 with {\arrowreversed{stealth}},
	mark= at position 0.5 with {\arrowreversed{stealth}},
	mark= at position 0.4 with {\arrowreversed{stealth}}},postaction={decorate}] ({sin(\myalpha)*\plate},{cos(\myalpha)*\plate},0)-- ({sin(\myalpha)*\plate},{cos(\myalpha)*\plate},-1)node[{anchor=north east},xshift=0.2cm] {$\begin{array}{c}
photon \,emitted \\
 from \,M
\end{array}$ };
 \draw[tdplot_rotated_coords,dashed] (O)--(Obs);
\draw[fill= gray!20,opacity=.5,tdplot_rotated_coords](\plate,\plate,0)-- (\plate,-\plate,0)--(-\plate,-\plate,0)-- (-\plate,\plate,0)--cycle;
\draw[tdplot_rotated_coords,dashed](0,\plate,0)-- (0,-\plate,0);
\draw[tdplot_rotated_coords,dashed](\plate,0,0)-- (-\plate,0,0);
\node[right=2,right] at (Obs) {\tiny$O^{'}$};
%\tdplotresetrotatedcoordsorigin
\tdplotsetcoord {Xaccc}{\modulus{\plate}{0}}{\teeta{\plate}{0}}{\fee{\plate}{0}};
\tdplotsetcoord  {Yaccc} {\modulus{0}{\plate}}{\teeta{0}{\plate}}{\fee{0}{\plate}};
\node[left] at (Xaccc) {\tiny$X^{"}$};
\node[right] at (Yaccc) {\tiny$Y^{"}$};
 \tdplotsetcoord{m}{\modulus{\plate}{\plate}}{0}{\myalpha};
\draw[tdplot_rotated_coords,ultra thick,](0,0,0)-- ({sin(\myalpha)*\plate},{cos(\myalpha)*\plate},0)node[right] {$m$ };
\tdplotdrawarc[tdplot_rotated_coords]{(Obs)}{\plate/2.5}{90}{90-\myalpha}{below,xshift=0.1cm }{$\alpha$}
\draw[tdplot_rotated_coords,](0,0,0)+({1.8*sin(\myalpha)*\plate/2},{1.5*cos(\myalpha)*\plate/2})node[left] {$d$ };;
\draw[tdplot_rotated_coords,](0,0,0)+(-4.8*\plate/1,2.2*\plate/1,0)node[left] {$\begin{array}{c}
Observers' \\
frame
\end{array}$ };;
\draw[fill = lightgray!50] (Obs) circle (0.5pt);
%\draw[fill = lightgray!50] (m) circle (0.5pt);
\end{scope}

 %draw perpendicular slice  to observer
      \tdplotsetrotatedcoords{270}{-\thetazero}{0};
      \begin{scope}[tdplot_rotated_coords]
      \draw[tdplot_rotated_coords](\R,0*\R,0) arc [start angle=0,end angle=90,x radius=\R,y radius=\R]--(0,\R,0)--(0,0,0)--cycle;
\path[tdplot_rotated_coords, thin , fill=gray!50,opacity=.21](0,0,0)-- (\R,0*\R,0) arc [start angle=0,end angle=180-\myalpha,x radius=\R,y radius=\R]--(0,0,0)--cycle;
%\path[tdplot_rotated_coords, thin ,fill=gray!50,opacity=.11](0,0,0)-- (\R,0*\R,0) arc [start angle=0,end angle=90,x radius=\R,y radius=\R]--(0,0,0)--cycle;

% pi/2-alpha  angle
 \draw[tdplot_rotated_coords,thick,ultra thick](0,\R,0) arc [start angle=90,end angle=90+90-\myalpha,x radius=\R,y radius=\R]node[midway,anchor = south west]{\large$\frac{\pi}{2}-\alpha$};
\end{scope}
%Let's go back to the black hole
%draw slice  parallel to observer
\tdplotsetrotatedcoords{270}{270-\thetazero}{0};
\begin{scope}[tdplot_rotated_coords]
\draw[tdplot_rotated_coords,thin](0,0,0)-- (\R,0*\R,0) arc [start angle=0,end angle=90,x radius=\R,y radius=\R]--(0,0,0)--cycle;
\path[tdplot_rotated_coords,thin,fill=gray!20,opacity=0.6](0,0,0)-- (\R,0*\R,0) arc [start angle=0,end angle=90,x radius=\R,y radius=\R]--(0,0,0)--cycle;
%\draw[tdplot_rotated_coords,ultra thick] (\R,0*\R,0) arc [start angle=0,end angle=90,x radius=\R,y radius=\R]node[midway,above=0.1cm]{\large$\gamma$};;
\end{scope}

  % draw geodesic
 \tdplotsetrotatedcoords{-45}{39}{ 52.23};
\begin{scope}[tdplot_rotated_coords]
 \draw[tdplot_rotated_coords,ultra thick,](\R,0,0) arc [start angle=0,end angle=90,x radius=\R,y radius=\R];%node[midway,anchor = south east]{\large$\mathbf{\gamma}$};;
 
\draw[tdplot_rotated_coords,thick, dashed](0,\R,0) arc [start angle=90,end angle=270,x radius=\R,y radius=\R];
\draw[tdplot_rotated_coords,thick](\R,0,0) arc [start angle=0,end angle=-90,x radius=\R,y radius=\R];
\path[tdplot_rotated_coords,thin,fill=gray!20,opacity=0.2,](0,0,0)-- (\R,0*\R,0) arc [start angle=0,end angle=90,x radius=\R,y radius=\R]--(0,0,0)--cycle;
\end{scope}

%Final decorations
\tdplotsetcoord{Xb}{\R}{90}{0};
 \tdplotsetrotatedcoords{90}{0}{0};
  \tdplotdrawarc[tdplot_rotated_coords,very thick,->]{(O)}{2.5}{0}{-\myphi}{anchor=north}{$\phi$} ;
  \tdplotsetrotatedcoords{0}{0}{0};
\draw[fill = white, tdplot_rotated_coords] (O) circle (1.5pt)node[{anchor=north east}]{};;
   \draw[fill = white, tdplot_rotated_coords] (Xb) circle (1.5pt)node[{anchor=north east}]{\large$X$};;
   \tdplotsetcoord{Yb}{\R}{90}{90};
   \draw[fill = white, tdplot_rotated_coords] (Yb) circle (1.5pt)node[{anchor=north west}]{\large$Y$};;
   \tdplotsetcoord{Zb}{\R}{0}{0};
   \draw[fill = white, tdplot_rotated_coords] (Zb) circle (1.5pt) node[{anchor=south east}]{\large$Z$};;
   \tdplotsetcoord{Yacc}{\R}{\thetazero}{90};
   \draw[fill = white, tdplot_rotated_coords] (Yacc) circle (1.5pt)node[right=0.2cm]{\large$Yâ€™$};
   \node at (Y1)[left=2.2cm]{\large$\gamma$};
  \draw[fill = white, tdplot_main_coords] (Xaccent) circle (1.5pt)node[right=0.1cm]{\large$X'$};
    \coordinate(Zacc) at (0,{-\R*cos(\thetazero)},{\R*sin(\thetazero)} );
    \draw[fill = white,  tdplot_main_coords] (Zacc) circle (1.5pt)node[above=0.2cm]{\large$Z'$};
    \pic[draw = black,angle radius =0.2cm, ]{right angle= Yacc--O--Zacc};
    \pic[draw = black,angle radius =0.2cm, ]{right angle= Xb--O--Yacc};
     \pic[draw = black,angle radius =0.2cm, ]{right angle= Xb--O--Zacc};
     \pic[draw = black,angle radius =0.2cm, ]{right angle= O--Obs--Xaccc};
     \coordinate(Nu) at ({1.4*\R*cos(\az*0.87}, {1.1*\R*sin(\az*0.75)},0) ;
\node[below=0.2cm,tdplot_rotated_coords,] at (MM) {\large$M$};
  \draw[ tdplot_main_coords,dashed] (MM)--(MMM);
  \draw[ tdplot_main_coords,dashed] (O)--(MM)node[anchor={north},midway]{$r$};
  \draw[fill = white,tdplot_rotated_coords,] (MM) circle (1.5pt);
\tdplotsetrotatedcoords{\az}{90}{270} % set the rotated coordinate system
   \tdplotsetcoord{M1}{\R}{0}{0)};
  \tdplotsetrotatedcoordsorigin{(M1)};
  \tdplotdrawarc[tdplot_rotated_coords,thick]{(MM)}{-1.5}{14}{-12}{anchor=south  west}{$\eta$};
  %\tdplotdrawarc[tdplot_rotated_coords,thick]{(MM)}{1.5}{14}{-12}{anchor=south  west}{$\eta$};;
%\draw (MM)--(MM) node[above right=0.4cm ]{\large$\eta$};;
%\draw (MM)--(MM) node[above right=0.4cm ]{\large$\eta$};;
\end{tikzpicture}